@attribute [Route(Routes.Factions)]
@inherits FluxorComponent

<MudContainer MaxWidth="MaxWidth.Large">
    @if (State.Value.Factions is not null)
    {
        var factions = State.Value.Factions ?? [];

        <MudGrid Class="mt-2">
            <MudItem xs="4">
                <MudPaper Class="pa-4 rounded-lg"
                          Elevation="0">
                    <MudList @bind-SelectedItem="_selectedListItem"
                             @bind-SelectedValue="_selectedFaction"
                             Clickable
                             DisablePadding>
                        <MudText Class="ml-4"
                                 Color="Color.Tertiary">
                            <b>Recruiting</b>
                        </MudText>
                        <MudDivider Class="my-2"
                                    DividerType="DividerType.Middle">
                        </MudDivider>
                        @foreach (var faction in factions.Where(faction => faction.IsRecruiting))
                        {
                            <MudListItem Class="rounded-lg"
                                         Value="faction">
                                @faction.Name
                            </MudListItem>
                        }
                        <MudText Class="ml-4 mt-8"
                                 Color="Color.Secondary">
                            <b>Not Recruiting</b>
                        </MudText>
                        <MudDivider Class="my-2"
                                    DividerType="DividerType.Middle">
                        </MudDivider>
                        @foreach (var faction in factions.Where(faction => !faction.IsRecruiting))
                        {
                            <MudListItem Class="rounded-lg"
                                         Value="faction">
                                @faction.Name
                            </MudListItem>
                        }
                    </MudList>
                </MudPaper>
            </MudItem>

            @if (_selectedFaction is Faction selectedFaction)
            {
                <MudItem xs="8">
                    <MudPaper Class="px-8 py-4 rounded-lg"
                              Elevation="0">
                        <MudStack AlignItems="AlignItems.Center"
                                  Justify="Justify.SpaceBetween"
                                  Row>
                            <MudText Typo="Typo.h6">
                                @selectedFaction.Name
                            </MudText>
                            <MudText Color="Color.Primary"
                                     Typo="Typo.h6">
                                [@selectedFaction.Symbol.Value]
                            </MudText>
                        </MudStack>

                        <MudDivider Class="my-4"
                                    DividerType="DividerType.Middle">
                        </MudDivider>

                        <MudStack AlignItems="AlignItems.Center"
                                  Justify="Justify.Center"
                                  Row
                                  Spacing="0">
                            @foreach (var trait in selectedFaction.Traits)
                            {
                                <MudTooltip Arrow>
                                    <ChildContent>
                                        <MudChip Color="Color.Secondary"
                                                 Variant="Variant.Text">
                                            @trait.Name
                                        </MudChip>
                                    </ChildContent>
                                    <TooltipContent>
                                        <MudText Class="ma-2"
                                                 Style="max-width: 500px"
                                                 Typo="Typo.body2">
                                            @trait.Description
                                        </MudText>
                                    </TooltipContent>
                                </MudTooltip>
                            }
                        </MudStack>

                        @if (!string.IsNullOrWhiteSpace(selectedFaction.Headquarters))
                        {
                            <MudText Class="mt-4">
                                <b>Headquarters:</b> <MudLink>@selectedFaction.Headquarters</MudLink>
                            </MudText>
                        }

                        <MudText Class="mt-4 word-break">@selectedFaction.Description</MudText>
                    </MudPaper>
                </MudItem>
            }
        </MudGrid>
    }
</MudContainer>

@code
{
    [Inject] private IState<FactionsState> State { get; set; } = null!;

    [Inject] private IDispatcher Dispatcher { get; set; } = null!;

    private MudListItem _selectedListItem;
    private object _selectedFaction;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        Dispatcher.Dispatch(new FactionsLoad());
    }
}