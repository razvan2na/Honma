@attribute [Route(Routes.Ships)]
@inherits FluxorComponent

<MudContainer MaxWidth="MaxWidth.Small">
    <AppSurface>
        <MudStack AlignItems="AlignItems.Center"
                  Justify="Justify.SpaceBetween"
                  Row>
            <MudStack AlignItems="AlignItems.Center"
                      Row
                      Spacing="2">
                <MudIcon Icon="@HonmaIcons.Ship"/>
                <MudText Typo="Typo.h6">Ships</MudText>
            </MudStack>
            <MudPagination BoundaryCount="1"
                           Count="@(State.Value.Pagination.Total / 10 + 1)"
                           MiddleCount="3"
                           Rectangular
                           Selected="_page"
                           SelectedChanged="PageChange"
                           Size="Size.Small"
                           Variant="Variant.Text"/>
        </MudStack>

        <MudList Class="mt-4"
                 Gutters="false"
                 T="string">
            @foreach (var ship in State.Value.Ships)
            {
                <MudListItem Class="rounded-lg"
                             Href="@($"{Routes.Ships}/{ship.Symbol}")"
                             T="string">
                    <ChildContent>
                        <MudStack AlignItems="AlignItems.Center"
                                  Justify="Justify.SpaceBetween"
                                  Row>
                            <MudStack AlignItems="AlignItems.Center"
                                      Class="width-full"
                                      Justify="Justify.SpaceBetween"
                                      Row>
                                <MudText>@ship.Symbol</MudText>
                                <MudStack AlignItems="AlignItems.Center"
                                          Row>
                                    <MudChip Color="Color.Secondary"
                                             Size="Size.Small"
                                             T="string"
                                             Variant="Variant.Text">
                                        @ship.Registration.Role
                                    </MudChip>
                                </MudStack>
                            </MudStack>

                            <MudIcon Icon="@HonmaIcons.CaretRight"
                                     Size="Size.Small"/>
                        </MudStack>
                    </ChildContent>
                </MudListItem>
            }
        </MudList>
    </AppSurface>
</MudContainer>

@code {

    [Inject] public required IState<ShipState> State { get; set; }

    [Inject] public required IDispatcher Dispatcher { get; set; }

    private int _page = 1;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        Dispatcher.Dispatch(new ShipsLoad(_page));
    }

    private void PageChange(int page)
    {
        _page = page;
        Dispatcher.Dispatch(new ShipsLoad(_page));
    }

}